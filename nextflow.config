
/*
 * -------------------------------------------------
 *  nf-core/proteogenomicsdb Nextflow config file
 * -------------------------------------------------
 * Default config options for all environments.
 */


//global default params, used in configs
params {

  //input options
  input = null

  //references
  igenomes_base   = 's3://ngi-igenomes/igenomes/'
  igenomes_ignore = false

  //skip options
  skip_fastqc   = true
  skip_trimming = true

  skip_rnaseqdb = true
  skip_dnaseq   = true
  skip_vcf      = true

  skip_ensembldb   = true
  skip_proteome    = true
  skip_ncrna       = true
  skip_pseudogenes = true
  skip_altorfs     = true
  skip_ensembl_vcf = true

  skip_cosmicdb  = true
  skip_celllines = true
  skip_cosmic    = true

  skip_genecodedb     = true
  skip_cbioportaldb = true
  skip_decoy        = true 


  //PROTEOGENOMICSDB inputs
  dna_config                = "$projectDir/conf/pypgatk_config_files/dna_config.yaml"
  custom_config             = "$projectDir/conf/pypgatk_config_files/custom_config.yaml"
  annotation                = null
  reference                 = null
  transcripts               = null
  faidx_get_genome_sizes    = true 
  samtools_sort_index       = 'bai'

  //ENSEMBLDB inputs
  ensembl_downloader_config = "$projectDir/conf/pypgatk_config_files/ensembl_downloader_config.yaml"
  ensembl_config            = "$projectDir/conf/pypgatk_config_files/ensembl_config.yaml"
  species_id                = null
  ncrna_config              = "$projectDir/conf/pypgatk_config_files/ncrna_config.yaml"
  pseudogenes_config        = "$projectDir/conf/pypgatk_config_files/pseudogenes_config.yaml"
  altorfs_config            = "$projectDir/conf/pypgatk_config_files/altorfs_config.yaml"

  //COSMICDB inputs
  cosmic_config = "$projectDir/conf/pypgatk_config_files/cosmic_config.yaml"
  username      = null
  password      = null 

  cosmic_genes_url               = null
  cosmic_mutations_url           = null
  cosmic_celllines_genes_url     = null
  cosmic_celllines_mutations_url = null

  params.cosmic_cancer_type = 'all'

  //GNOMADDB inputs
  genecode_transcripts_url = null
  genecode_annotations_url = null
  gnomad_url               = null
  genecode_config            = "$projectDir/conf/pypgatk_config_files/genecode_config.yaml"

  //CBIOPORTALDB inputs
  cbioportal_url = null
  grch38_url     = 'ftp://ftp.ensembl.org/pub/release-115/fasta/homo_sapiens/cdna/Homo_sapiens.GRCh38.cdna.all.fa.gz'
  cbio_config    = "$projectDir/conf/pypgatk_config_files/cbioportal_config.yaml"
  cbio_study     = null

  //MERGEDB inputs
  clean_config = "$projectDir/conf/pypgatk_config_files/clean_config.yaml"
  decoy_config = "$projectDir/conf/pypgatk_config_files/protein_decoy.yaml"

  //multiqc options
  multiqc_config              = "$projectDir/assets/multiqc_config.yaml"
  multiqc_logo                = null
  max_multiqc_email_size      = '25.MB'
  multiqc_methods_description = null

  //boilerplate options
  outdir           = null
  publish_dir_mode = 'copy'
  email            = null
  email_on_fail    = null 
  plaintext_email  = false
  monochrome_logs  = false
  hook_url         = System.getenv('HOOK_URL')
  help             = false
  help_full        = false
  show_hidden      = false
  version          = false
  pipelines_testdata_base_path = 'https://raw.githubusercontent.com/nf-core/test-datasets/7f1614bae0ddf66e60be78c3d9fa55440465ac8/'
  trace_report_suffix          = new java.util.Date().format('yyyy-MM-dd_HH-mm-ss')

  //config options
  config_profile_name        = null
  config_profile_description = null

  custom_config_version  = 'master'
  custom_config_base     = 'https://raw.githubusercontent.com/nf-core/configs/master'
  //custom_config_base   = 'https://raw.githubusercontent.com/nf-core/configs/${params.custom_config_version}'
  config_profile_contact = null
  config_profile_url     = null

  //schema validation default options
  validate_params = true

}

//default publishing logic 
process { 
  publishDIr = [
    path: { "${params.outdir}/${task.process.tokenize(':')[-1].tokenize('_')[0].tolowercase()}" },
    mode: params.publish_dir_mode,
    saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
  ]
}

//global default params, used in configs
//container slug. Stable releases should specify release tag!
//developmental code should specify :dev
process.container = 'nfcore/proteogenomicsdb:1.0.0'

profiles {

  conda {
    docker.enabled = false
    singularity.enabled = false
    podman.enabled = false
    shifter.enabled = false
    charliecloud = false
    conda.createTimeout = '1 h'
    process.conda = "$projectDir/environment.yml"
  }
  debug { process.beforeScript = 'echo $HOSTNAME' }
  docker {
    docker.enabled = true
    singularity.enabled = false
    podman.enabled = false
    shifter.enabled = false
    charliecloud.enabled = false
    // Avoid this error:
    //   WARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.
    // Testing this in nf-core after discussion here https://github.com/nf-core/tools/pull/351
    // once this is established and works well, nextflow might implement this behavior as new default.
    docker.runOptions = '-u \$(id -u):\$(id -g)'
  }
  singularity {
    docker.enabled = false
    singularity.enabled = true
    podman.enabled = false
    shifter.enabled = false
    charliecloud.enabled = false
    singularity.autoMounts = true
    singularity.envWhitelist = "SINGULARITY_TMPDIR,TMPDIR"
    singularity.runOptions   = "-B \$HOME"
    singularity.cacheDir     = "/exports/eddie/scratch/s2215490/.cache"
  }
  podman {
    singularity.enabled = false
    docker.enabled = false
    podman.enabled = true
    shifter.enabled = false
    charliecloud = false
  }
  shifter {
    singularity.enabled = false
    docker.enabled = false
    podman.enabled = false
    shifter.enabled = true
    charliecloud.enabled = false
  }
  charliecloud {
    singularity.enabled = false
    docker.enabled = false
    podman.enabled = false
    shifter.enabled = false
    charliecloud.enabled = true
  }
  test { includeConfig 'conf/test.config' }
  test_full { includeConfig 'conf/test_full.config' }
  dev { includeConfig 'conf/dev.config' }
}

//capture exit codes from upstream processes when piping
process.shell = [
    '/bin/bash',
    '-C',      // No clobber - prevent output redirection from overwriting files.
    '-e',      // Exit if a tool returns a non-zero status/exit code
    '-u',      // Treat unset variables and parameters as an error
    '-o',      // Returns the status of the last command to exit..
    'pipefail' //..with a non-zero status or zero if all successfully execute
]

//disable process selector warnings by default
nextflow.enable.configProcessNamesValidation = false

timeline {
  enabled = true
  file = "${params.outdir}/execution_timeline_${params.trace_report_suffix}.html"
}
report {
  enabled = true
  file = "${params.outdir}/execution_report_${params.trace_report_suffix}.html"
}
trace {
  enabled = true
  file = "${params.outdir}/execution_trace_${params.trace_report_suffix}.txt"
}
dag {
  enabled = true
  file = "${params.outdir}/pipeline_dag_${params.trace_report_suffix}.html"
}

manifest {
    name            = 'nf-core/proteogenomicsdb'
    contributors    = [
        // TODO nf-core: Update the field with the details of the contributors to your pipeline. New with Nextflow version 24.10.0
        [
            name: 'Alistair Rice',
            affiliation: '',
            email: '',
            github: '',
            contribution: [], // List of contribution types ('author', 'maintainer' or 'contributor')
            orcid: ''
        ],
        [
            name: ' Hywel Dunn-Davies',
            affiliation: '',
            email: '',
            github: '',
            contribution: [], // List of contribution types ('author', 'maintainer' or 'contributor')
            orcid: ''
        ],
        [
            name: ' Yasset Perez Riverol',
            affiliation: '',
            email: '',
            github: '',
            contribution: [], // List of contribution types ('author', 'maintainer' or 'contributor')
            orcid: ''
        ],
        [
            name: ' and Husen M. Umer',
            affiliation: '',
            email: '',
            github: '',
            contribution: [], // List of contribution types ('author', 'maintainer' or 'contributor')
            orcid: ''
        ],
    ]
    homePage        = 'https://github.com/nf-core/proteogenomicsdb'
    description     = """The proteogenomicsdb pipeline (formerly known as pgdb) creates custom protein databases for ProteoGenomics data analysis."""
    mainScript      = 'main.nf'
    defaultBranch   = 'main'
    nextflowVersion = '!>=25.04.0'
    version         = '2.0.0'
    doi             = ''
}

plugins {
  id 'nf-google@1.9.0' //allows for the downloading of files off of goole drives
  id 'nf-schema@2.5.1' //validation of pipeline parameters and creation of an input channel from a sample sheet
}

validation {

  defaultIgnoreParams = ['genomes']
  monochromeLogs = params.monochrome_logs
  help.enabled = true
}

//load modules.config for DSL2 module specific options
includeConfig 'conf/modules.config'
//load base.config by default for all pipelines
includeConfig 'conf/base.config'
//load nf-core custom profiles from different institutions                                                                                                                                           â”‚
includeConfig params.custom_config_base && (!System.getenv('NXF_OFFLINE') || !params.custom_config_base.startsWith('http')) ? "${params.custom_config_base}/nfcore_custom.config" : "/dev/null"
//load ignomes.config if required
includeConfig !params.igenomes_ignore ? 'conf/igenomes.config' : 'conf/igenomes_ignored.config'


/*
singularity {

  enabled      = true
  autoMounts   = true
  envWhitelist = "SINGULARITY_TMPDIR,TMPDIR"
  runOptions   = "-B \$HOME"
  cacheDir     = "/exports/eddie/scratch/s2215490/.cache"
}
*/

/*
//export these variables to prevent local Python/R libraries from conflicting with those in the container
env {
  PYTHONNOUSERSITE = 1
  R_PROFILE_USER = "/.Rprofile"
  R_ENVIRON_USER = "/.Renviron"
}
*/