nextflow_workflow {

    name "Test Subworkflow COSMICDB"
    script "../cosmic_workflow.nf"
    workflow "COSMICDB"
    config "./nextflow.config"

    test("--skip_cosmicdb false") {

        when {
            workflow {
                """

                input[0]  = file('$projectDir/conf/pypgatk_config_files/cosmic_config.yaml', checkIfExists: true)
                input[1]  = 'username'
                input[2]  = 'password'
                input[3]  = 'https://cancer.sanger.ac.uk/api/mono/products/v1/downloads/scripted?path=grch38/cosmic/v103/Cosmic_Genes_Fasta_v103_GRCh38.tar&bucket=downloads'
                input[4]  = 'https://cancer.sanger.ac.uk/api/mono/products/v1/downloads/scripted?path=grch38/cosmic/v103/Cosmic_GenomeScreensMutant_Tsv_v103_GRCh38.tar&bucket=downloads'
                
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.versions_ch,
                    workflow.out.cosmic_database
                ).match() }
            )
        }
    }

    test("--skip_cosmicdb false -stub") {

        when {
            workflow {
                """
                input[0]  = file('$projectDir/conf/pypgatk_config_files/cosmic_config.yaml', checkIfExists: true)
                input[1]  = 'username'
                input[2]  = 'password'
                input[3]  = 'https://cancer.sanger.ac.uk/api/mono/products/v1/downloads/scripted?path=grch38/cosmic/v103/Cosmic_Genes_Fasta_v103_GRCh38.tar&bucket=downloads'
                input[4]  = 'https://cancer.sanger.ac.uk/api/mono/products/v1/downloads/scripted?path=grch38/cosmic/v103/Cosmic_GenomeScreensMutant_Tsv_v103_GRCh38.tar&bucket=downloads'

                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.versions_ch,
                    workflow.out.cosmic_database
                ).match() }
            )
        }
    }
}