nextflow_workflow {

    name "Test Subworkflow CBIOPORTALDB"
    script "../main.nf"
    workflow "CBIOPORTALDB"
    config "./nextflow.config"

    test("default options") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter          = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false
                use_sentieon_star        = false

                input[0]  = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1]  = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2]  = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3]  = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4]  = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }